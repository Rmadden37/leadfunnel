<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Solar Form Submission</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-xl p-6">
        <h1 class="text-2xl font-bold mb-4">Test Solar Form</h1>
        
        <form id="test-form" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Name</label>
                <input type="text" name="name" value="Test User" required class="w-full p-2 border rounded">
            </div>
            
            <div>
                <label class="block text-sm font-medium mb-1">Address</label>
                <input type="text" name="address" value="123 Test Street" required class="w-full p-2 border rounded">
            </div>
            
            <div>
                <label class="block text-sm font-medium mb-1">City</label>
                <input type="text" name="city" value="Tampa" required class="w-full p-2 border rounded">
            </div>
            
            <div>
                <label class="block text-sm font-medium mb-1">ZIP Code</label>
                <input type="text" name="zip" value="33601" required class="w-full p-2 border rounded">
            </div>
            
            <div>
                <label class="block text-sm font-medium mb-1">Phone</label>
                <input type="tel" name="phone" value="(813) 555-1234" required class="w-full p-2 border rounded">
            </div>
            
            <div>
                <label class="block text-sm font-medium mb-1">Email</label>
                <input type="email" name="email" value="test@example.com" required class="w-full p-2 border rounded">
            </div>
            
            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                Test Submit
            </button>
        </form>
        
        <div id="result" class="mt-4 p-3 rounded hidden"></div>
    </div>

    <script>
        class TestFormHandler {
            constructor() {
                // Your actual Web App URL
                this.googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycby6osA7_S11crjPH_xNCmN5nTyftigdTkJZOw4GC7N6jVUgUgWqPX8Ay4347c_ZUTdO/exec';
                this.init();
            }

            init() {
                const form = document.getElementById('test-form');
                form.addEventListener('submit', (e) => this.handleSubmit(e));
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                const form = e.target;
                const formData = new FormData(form);
                const submitBtn = form.querySelector('button[type="submit"]');
                const resultDiv = document.getElementById('result');
                
                // Show loading
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;
                resultDiv.className = 'mt-4 p-3 rounded bg-blue-100 text-blue-800';
                resultDiv.textContent = 'Submitting form...';
                resultDiv.classList.remove('hidden');
                
                try {
                    const data = {
                        name: formData.get('name'),
                        address: formData.get('address'),
                        city: formData.get('city'),
                        zip: formData.get('zip'),
                        phone: formData.get('phone'),
                        email: formData.get('email'),
                        source: 'Test Form',
                        timestamp: new Date().toLocaleString(),
                        page_url: window.location.href,
                        user_agent: navigator.userAgent,
                        referrer: document.referrer || 'Direct'
                    };
                    
                    console.log('Submitting data:', data);
                    
                    const response = await fetch(this.googleAppsScriptUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    // Since no-cors mode prevents reading response, we assume success
                    resultDiv.className = 'mt-4 p-3 rounded bg-green-100 text-green-800';
                    resultDiv.innerHTML = `
                        <strong>✅ Form submitted successfully!</strong><br>
                        Check your Google Sheets and email for:
                        <ul class="mt-2 ml-4 list-disc">
                            <li>New row in Google Sheets</li>
                            <li>Email to ryanmadden.fl@gmail.com</li>
                            <li>Welcome email to ${data.email}</li>
                        </ul>
                    `;
                    
                } catch (error) {
                    console.error('Submission failed:', error);
                    resultDiv.className = 'mt-4 p-3 rounded bg-red-100 text-red-800';
                    resultDiv.innerHTML = `<strong>❌ Error:</strong> ${error.message}`;
                }
                
                // Reset button
                submitBtn.textContent = 'Test Submit';
                submitBtn.disabled = false;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new TestFormHandler();
        });
    </script>
</body>
</html>
