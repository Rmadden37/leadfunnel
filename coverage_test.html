<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Coverage Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-location { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .button { background: #4CAF50; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .log { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 11px; max-height: 200px; overflow-y: auto; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>Solar API Coverage Test</h1>
    <p>Testing different locations to find where flux data is available...</p>
    
    <div class="test-location">
        <h3>Known Good Locations</h3>
        <button class="button" onclick="testLocation(37.4419, -122.1430, 'Palo Alto, CA (Google HQ)')">Palo Alto, CA</button>
        <button class="button" onclick="testLocation(40.7589, -73.9851, 'New York, NY')">New York, NY</button>
        <button class="button" onclick="testLocation(34.0522, -118.2437, 'Los Angeles, CA')">Los Angeles, CA</button>
        <button class="button" onclick="testLocation(25.7617, -80.1918, 'Miami, FL')">Miami, FL</button>
        <button class="button" onclick="testLocation(27.9306, -82.4497, 'Davis Islands, Tampa, FL')">Davis Islands, FL</button>
    </div>
    
    <div id="results"></div>

    <script>
        const API_KEY = 'AIzaSyBzcUXYvRZVWAMasN93T9radVmiZVnaflk';

        async function testLocation(lat, lng, name) {
            const resultsDiv = document.getElementById('results');
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-location';
            testDiv.innerHTML = `
                <h4>Testing: ${name}</h4>
                <div class="log" id="log-${lat}-${lng}">Testing...</div>
            `;
            resultsDiv.appendChild(testDiv);
            
            const logDiv = testDiv.querySelector('.log');
            
            function log(message, type = 'info') {
                const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
                logDiv.innerHTML += `<div class="${className}">${message}</div>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
            
            try {
                log(`Coordinates: ${lat}, ${lng}`);
                
                // Test building insights first
                const insightsUrl = `https://solar.googleapis.com/v1/buildingInsights:findClosest?location.latitude=${lat}&location.longitude=${lng}&requiredQuality=HIGH&key=${API_KEY}`;
                
                log('Testing building insights...');
                const insightsResponse = await fetch(insightsUrl);
                
                if (insightsResponse.ok) {
                    const insightsData = await insightsResponse.json();
                    log(`✅ Building insights: ${insightsData.solarPotential ? 'YES' : 'NO'}`, 'success');
                } else {
                    log(`❌ Building insights failed: ${insightsResponse.status}`, 'error');
                }
                
                // Test data layers
                const dataUrl = `https://solar.googleapis.com/v1/dataLayers:get?location.latitude=${lat}&location.longitude=${lng}&radiusMeters=100&view=FULL_LAYERS&requiredQuality=HIGH&pixelSizeMeters=0.5&key=${API_KEY}`;
                
                log('Testing data layers...');
                const dataResponse = await fetch(dataUrl);
                
                if (dataResponse.ok) {
                    const data = await dataResponse.json();
                    const keys = Object.keys(data);
                    log(`✅ Data layers keys: ${keys.join(', ')}`);
                    
                    if (data.annualFluxUrl) {
                        log(`✅ HAS ANNUAL FLUX URL!`, 'success');
                        
                        // Test URL accessibility
                        const fluxUrl = `${data.annualFluxUrl}&key=${API_KEY}`;
                        const fluxTest = await fetch(fluxUrl, { method: 'HEAD' });
                        log(`Flux URL test: ${fluxTest.status} ${fluxTest.statusText}`, fluxTest.ok ? 'success' : 'error');
                        
                        if (data.dsmBounds) {
                            log(`✅ Has bounds: SW(${data.dsmBounds.sw.latitude}, ${data.dsmBounds.sw.longitude})`, 'success');
                        }
                        
                    } else {
                        log(`❌ No annualFluxUrl found`, 'warning');
                        
                        // Check for other flux-related keys
                        const fluxKeys = keys.filter(k => k.toLowerCase().includes('flux'));
                        if (fluxKeys.length > 0) {
                            log(`Found other flux keys: ${fluxKeys.join(', ')}`, 'warning');
                        }
                    }
                    
                } else {
                    const errorText = await dataResponse.text();
                    log(`❌ Data layers failed: ${dataResponse.status} - ${errorText}`, 'error');
                }
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
